name: run container command
description: |
  This action runs a specified command within a container using an optionally specified image.

inputs:
  image:
    description: The Docker image to use.
    # Image can be edited at https://github.com/use-ink/docker-images
    default: evilrobot/useink:pr-4
  command:
    description: The command to run
    required: true
  output-info:
    description: Whether to output environment information
    default: 'true'

runs:
  using: composite

  steps:
    - name: Set Image
      id: set_image
      outputs:
        IMAGE: ${{ inputs.image }}

    - name: Rust Info
      uses: "docker://${{ steps.set_image.outputs.IMAGE }}"
      if: ${{ inputs.output-info == 'true' }}
      with:
        entrypoint: /bin/bash
        args: > 
          -c 
          "rustup show
          cargo --version
          rustup +nightly show
          cargo +nightly --version
          bash --version
          ink-node --version
          cargo contract --version
          git --version
          echo -e '[registry]\nprotocol = \"sparse\"' > /usr/local/cargo/config.toml"

    - name: Run command in container
      uses: "docker://${{ steps.set_image.outputs.IMAGE }}"
      with:
        entrypoint: /bin/bash
        args: -c "${{ inputs.command }}"